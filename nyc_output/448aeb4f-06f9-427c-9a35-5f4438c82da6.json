{"/home/administrator/private/odatafy-mongodb/src/mongodbGenerator.ts":{"path":"/home/administrator/private/odatafy-mongodb/src/mongodbGenerator.ts","statementMap":{"0":{"start":{"line":2,"column":13},"end":{"line":17,"column":1}},"1":{"start":{"line":3,"column":12},"end":{"line":3,"column":62}},"2":{"start":{"line":4,"column":4},"end":{"line":4,"column":21}},"3":{"start":{"line":4,"column":12},"end":{"line":4,"column":21}},"4":{"start":{"line":5,"column":12},"end":{"line":5,"column":21}},"5":{"start":{"line":5,"column":31},"end":{"line":5,"column":33}},"6":{"start":{"line":6,"column":4},"end":{"line":15,"column":5}},"7":{"start":{"line":7,"column":8},"end":{"line":7,"column":83}},"8":{"start":{"line":7,"column":66},"end":{"line":7,"column":83}},"9":{"start":{"line":9,"column":20},"end":{"line":9,"column":41}},"10":{"start":{"line":11,"column":8},"end":{"line":14,"column":41}},"11":{"start":{"line":12,"column":12},"end":{"line":12,"column":61}},"12":{"start":{"line":12,"column":51},"end":{"line":12,"column":61}},"13":{"start":{"line":14,"column":18},"end":{"line":14,"column":39}},"14":{"start":{"line":14,"column":25},"end":{"line":14,"column":39}},"15":{"start":{"line":16,"column":4},"end":{"line":16,"column":14}},"16":{"start":{"line":18,"column":20},"end":{"line":26,"column":1}},"17":{"start":{"line":19,"column":4},"end":{"line":24,"column":5}},"18":{"start":{"line":19,"column":40},"end":{"line":24,"column":5}},"19":{"start":{"line":19,"column":53},"end":{"line":19,"column":54}},"20":{"start":{"line":19,"column":60},"end":{"line":19,"column":71}},"21":{"start":{"line":20,"column":8},"end":{"line":23,"column":9}},"22":{"start":{"line":21,"column":12},"end":{"line":21,"column":65}},"23":{"start":{"line":21,"column":21},"end":{"line":21,"column":65}},"24":{"start":{"line":22,"column":12},"end":{"line":22,"column":28}},"25":{"start":{"line":25,"column":4},"end":{"line":25,"column":61}},"26":{"start":{"line":27,"column":22},"end":{"line":29,"column":1}},"27":{"start":{"line":28,"column":4},"end":{"line":28,"column":62}},"28":{"start":{"line":30,"column":0},"end":{"line":30,"column":62}},"29":{"start":{"line":31,"column":0},"end":{"line":31,"column":74}},"30":{"start":{"line":32,"column":12},"end":{"line":32,"column":43}},"31":{"start":{"line":33,"column":24},"end":{"line":33,"column":52}},"32":{"start":{"line":34,"column":23},"end":{"line":34,"column":50}},"33":{"start":{"line":35,"column":22},"end":{"line":35,"column":48}},"34":{"start":{"line":36,"column":22},"end":{"line":36,"column":48}},"35":{"start":{"line":37,"column":24},"end":{"line":37,"column":52}},"36":{"start":{"line":39,"column":16},"end":{"line":39,"column":57}},"37":{"start":{"line":40,"column":22},"end":{"line":40,"column":68}},"38":{"start":{"line":41,"column":17},"end":{"line":41,"column":35}},"39":{"start":{"line":42,"column":26},"end":{"line":42,"column":28}},"40":{"start":{"line":43,"column":4},"end":{"line":51,"column":7}},"41":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"42":{"start":{"line":46,"column":12},"end":{"line":46,"column":120}},"43":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"44":{"start":{"line":49,"column":12},"end":{"line":49,"column":91}},"45":{"start":{"line":52,"column":4},"end":{"line":52,"column":37}},"46":{"start":{"line":54,"column":0},"end":{"line":54,"column":42}},"47":{"start":{"line":56,"column":19},"end":{"line":56,"column":21}},"48":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"49":{"start":{"line":58,"column":8},"end":{"line":58,"column":93}},"50":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"51":{"start":{"line":61,"column":8},"end":{"line":61,"column":92}},"52":{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},"53":{"start":{"line":64,"column":8},"end":{"line":64,"column":86}},"54":{"start":{"line":66,"column":4},"end":{"line":68,"column":5}},"55":{"start":{"line":67,"column":8},"end":{"line":67,"column":86}},"56":{"start":{"line":69,"column":4},"end":{"line":71,"column":5}},"57":{"start":{"line":70,"column":8},"end":{"line":70,"column":167}},"58":{"start":{"line":72,"column":4},"end":{"line":72,"column":20}},"59":{"start":{"line":74,"column":0},"end":{"line":74,"column":28}},"60":{"start":{"line":76,"column":4},"end":{"line":78,"column":8}},"61":{"start":{"line":80,"column":0},"end":{"line":80,"column":34}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":38},"end":{"line":2,"column":39}},"loc":{"start":{"line":2,"column":54},"end":{"line":17,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":18,"column":52},"end":{"line":18,"column":53}},"loc":{"start":{"line":18,"column":78},"end":{"line":26,"column":1}},"line":18},"2":{"name":"(anonymous_2)","decl":{"start":{"line":27,"column":56},"end":{"line":27,"column":57}},"loc":{"start":{"line":27,"column":71},"end":{"line":29,"column":1}},"line":27},"3":{"name":"getQueryFromUrl","decl":{"start":{"line":38,"column":9},"end":{"line":38,"column":24}},"loc":{"start":{"line":38,"column":35},"end":{"line":53,"column":1}},"line":38},"4":{"name":"(anonymous_4)","decl":{"start":{"line":43,"column":24},"end":{"line":43,"column":25}},"loc":{"start":{"line":43,"column":41},"end":{"line":51,"column":5}},"line":43},"5":{"name":"getQuery","decl":{"start":{"line":55,"column":9},"end":{"line":55,"column":17}},"loc":{"start":{"line":55,"column":30},"end":{"line":73,"column":1}},"line":55},"6":{"name":"testMongoDB","decl":{"start":{"line":75,"column":9},"end":{"line":75,"column":20}},"loc":{"start":{"line":75,"column":23},"end":{"line":79,"column":1}},"line":75}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":13},"end":{"line":17,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":14},"end":{"line":2,"column":18}},{"start":{"line":2,"column":22},"end":{"line":2,"column":33}},{"start":{"line":2,"column":38},"end":{"line":17,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":62}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":40}},{"start":{"line":3,"column":44},"end":{"line":3,"column":62}}],"line":3},"2":{"loc":{"start":{"line":4,"column":4},"end":{"line":4,"column":21}},"type":"if","locations":[{"start":{"line":4,"column":4},"end":{"line":4,"column":21}},{"start":{"line":4,"column":4},"end":{"line":4,"column":21}}],"line":4},"3":{"loc":{"start":{"line":7,"column":15},"end":{"line":7,"column":64}},"type":"binary-expr","locations":[{"start":{"line":7,"column":16},"end":{"line":7,"column":28}},{"start":{"line":7,"column":32},"end":{"line":7,"column":39}},{"start":{"line":7,"column":44},"end":{"line":7,"column":64}}],"line":7},"4":{"loc":{"start":{"line":12,"column":12},"end":{"line":12,"column":61}},"type":"if","locations":[{"start":{"line":12,"column":12},"end":{"line":12,"column":61}},{"start":{"line":12,"column":12},"end":{"line":12,"column":61}}],"line":12},"5":{"loc":{"start":{"line":12,"column":16},"end":{"line":12,"column":49}},"type":"binary-expr","locations":[{"start":{"line":12,"column":16},"end":{"line":12,"column":17}},{"start":{"line":12,"column":21},"end":{"line":12,"column":28}},{"start":{"line":12,"column":33},"end":{"line":12,"column":48}}],"line":12},"6":{"loc":{"start":{"line":14,"column":18},"end":{"line":14,"column":39}},"type":"if","locations":[{"start":{"line":14,"column":18},"end":{"line":14,"column":39}},{"start":{"line":14,"column":18},"end":{"line":14,"column":39}}],"line":14},"7":{"loc":{"start":{"line":18,"column":20},"end":{"line":26,"column":1}},"type":"binary-expr","locations":[{"start":{"line":18,"column":21},"end":{"line":18,"column":25}},{"start":{"line":18,"column":29},"end":{"line":18,"column":47}},{"start":{"line":18,"column":52},"end":{"line":26,"column":1}}],"line":18},"8":{"loc":{"start":{"line":19,"column":4},"end":{"line":24,"column":5}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":24,"column":5}},{"start":{"line":19,"column":4},"end":{"line":24,"column":5}}],"line":19},"9":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":38}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":12}},{"start":{"line":19,"column":16},"end":{"line":19,"column":38}}],"line":19},"10":{"loc":{"start":{"line":20,"column":8},"end":{"line":23,"column":9}},"type":"if","locations":[{"start":{"line":20,"column":8},"end":{"line":23,"column":9}},{"start":{"line":20,"column":8},"end":{"line":23,"column":9}}],"line":20},"11":{"loc":{"start":{"line":20,"column":12},"end":{"line":20,"column":30}},"type":"binary-expr","locations":[{"start":{"line":20,"column":12},"end":{"line":20,"column":14}},{"start":{"line":20,"column":18},"end":{"line":20,"column":30}}],"line":20},"12":{"loc":{"start":{"line":21,"column":12},"end":{"line":21,"column":65}},"type":"if","locations":[{"start":{"line":21,"column":12},"end":{"line":21,"column":65}},{"start":{"line":21,"column":12},"end":{"line":21,"column":65}}],"line":21},"13":{"loc":{"start":{"line":25,"column":21},"end":{"line":25,"column":59}},"type":"binary-expr","locations":[{"start":{"line":25,"column":21},"end":{"line":25,"column":23}},{"start":{"line":25,"column":27},"end":{"line":25,"column":59}}],"line":25},"14":{"loc":{"start":{"line":27,"column":22},"end":{"line":29,"column":1}},"type":"binary-expr","locations":[{"start":{"line":27,"column":23},"end":{"line":27,"column":27}},{"start":{"line":27,"column":31},"end":{"line":27,"column":51}},{"start":{"line":27,"column":56},"end":{"line":29,"column":1}}],"line":27},"15":{"loc":{"start":{"line":28,"column":11},"end":{"line":28,"column":61}},"type":"cond-expr","locations":[{"start":{"line":28,"column":37},"end":{"line":28,"column":40}},{"start":{"line":28,"column":43},"end":{"line":28,"column":61}}],"line":28},"16":{"loc":{"start":{"line":28,"column":12},"end":{"line":28,"column":33}},"type":"binary-expr","locations":[{"start":{"line":28,"column":12},"end":{"line":28,"column":15}},{"start":{"line":28,"column":19},"end":{"line":28,"column":33}}],"line":28},"17":{"loc":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},{"start":{"line":45,"column":8},"end":{"line":47,"column":9}}],"line":45},"18":{"loc":{"start":{"line":45,"column":12},"end":{"line":45,"column":66}},"type":"binary-expr","locations":[{"start":{"line":45,"column":12},"end":{"line":45,"column":34}},{"start":{"line":45,"column":38},"end":{"line":45,"column":66}}],"line":45},"19":{"loc":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},{"start":{"line":48,"column":8},"end":{"line":50,"column":9}}],"line":48},"20":{"loc":{"start":{"line":48,"column":12},"end":{"line":48,"column":66}},"type":"binary-expr","locations":[{"start":{"line":48,"column":12},"end":{"line":48,"column":34}},{"start":{"line":48,"column":38},"end":{"line":48,"column":66}}],"line":48},"21":{"loc":{"start":{"line":49,"column":44},"end":{"line":49,"column":88}},"type":"cond-expr","locations":[{"start":{"line":49,"column":69},"end":{"line":49,"column":74}},{"start":{"line":49,"column":77},"end":{"line":49,"column":88}}],"line":49},"22":{"loc":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"type":"if","locations":[{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},{"start":{"line":57,"column":4},"end":{"line":59,"column":5}}],"line":57},"23":{"loc":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},{"start":{"line":60,"column":4},"end":{"line":62,"column":5}}],"line":60},"24":{"loc":{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},{"start":{"line":63,"column":4},"end":{"line":65,"column":5}}],"line":63},"25":{"loc":{"start":{"line":66,"column":4},"end":{"line":68,"column":5}},"type":"if","locations":[{"start":{"line":66,"column":4},"end":{"line":68,"column":5}},{"start":{"line":66,"column":4},"end":{"line":68,"column":5}}],"line":66},"26":{"loc":{"start":{"line":69,"column":4},"end":{"line":71,"column":5}},"type":"if","locations":[{"start":{"line":69,"column":4},"end":{"line":71,"column":5}},{"start":{"line":69,"column":4},"end":{"line":71,"column":5}}],"line":69}},"s":{"0":1,"1":2,"2":2,"3":0,"4":2,"5":2,"6":2,"7":2,"8":8,"9":0,"10":2,"11":2,"12":0,"13":2,"14":0,"15":2,"16":1,"17":2,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":2,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":61,"37":61,"38":61,"39":61,"40":61,"41":305,"42":0,"43":305,"44":61,"45":61,"46":1,"47":61,"48":61,"49":54,"50":61,"51":3,"52":61,"53":1,"54":61,"55":1,"56":61,"57":2,"58":61,"59":1,"60":0,"61":1},"f":{"0":2,"1":2,"2":1,"3":61,"4":305,"5":61,"6":0},"b":{"0":[1,1,1],"1":[2,2],"2":[0,2],"3":[10,0,10],"4":[0,2],"5":[2,2,0],"6":[0,2],"7":[1,1,1],"8":[0,2],"9":[2,2],"10":[0,0],"11":[0,0],"12":[0,0],"13":[2,2],"14":[1,1,1],"15":[0,1],"16":[1,1],"17":[0,305],"18":[305,0],"19":[61,244],"20":[305,305],"21":[0,61],"22":[54,7],"23":[3,58],"24":[1,60],"25":[1,60],"26":[2,59]},"inputSourceMap":{"version":3,"file":"/home/administrator/private/odatafy-mongodb/src/mongodbGenerator.ts","sources":["/home/administrator/private/odatafy-mongodb/src/mongodbGenerator.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,4CAAsB;AAEtB,qDAAgE;AAChE,mDAA4D;AAC5D,iDAA2D;AAC3D,iDAA8D;AAC9D,qDAA6D;AAK7D,SAAgB,eAAe,CAAC,QAAgB;IAC5C,IAAM,KAAK,GAAG,aAAG,CAAC,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,KAAK,CAAC;IAC9C,IAAM,WAAW,GAAG,CAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,EAAE,KAAK,EAAE,QAAQ,CAAE,CAAC;IACrE,IAAM,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAElC,IAAI,eAAe,GAAoB,EAAE,CAAA;IAEzC,WAAW,CAAC,OAAO,CAAC,UAAC,KAAa;QAC9B,eAAe;QACf,IAAG,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,GAAG,GAAG,KAAK,CAAC,EAAE;YACvD,MAAM,IAAI,KAAK,CAAC,qDAA8C,KAAK,0BAAgB,KAAK,CAAE,CAAC,CAAA;SAC9F;QAED,IAAG,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,GAAG,GAAG,KAAK,CAAC,EAAE;YACvD,eAAe,CAAC,KAA8B,CAAC,GAAG,KAAK,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAA,CAAC,CAAC,KAAK,CAAA,CAAC,CAAC,GAAG,GAAG,KAAK,CAAC,CAAW,CAAA;SAClH;IACL,CAAC,CAAC,CAAC;IAEH,OAAO,QAAQ,CAAC,eAAe,CAAC,CAAC;AACrC,CAAC;AAnBD,0CAmBC;AAED,SAAgB,QAAQ,CAAC,UAA2B;IAChD,IAAM,QAAQ,GAAe,EAAE,CAAC;IAEhC,IAAI,UAAU,CAAC,MAAM,EAAE;QACnB,QAAQ,CAAC,IAAI,CAAC,IAAA,6CAA2B,EAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC;KACjE;IAED,IAAG,UAAU,CAAC,OAAO,EAAE;QACnB,QAAQ,CAAC,IAAI,CAAC,IAAA,2CAA2B,EAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;KAClE;IAED,IAAI,UAAU,CAAC,IAAI,EAAE;QACjB,QAAQ,CAAC,IAAI,CAAC,IAAA,wCAAwB,EAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC;KAC5D;IAED,IAAI,UAAU,CAAC,GAAG,EAAE;QAChB,QAAQ,CAAC,IAAI,CAAC,IAAA,yCAAwB,EAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC;KAC3D;IAED,IAAG,UAAU,CAAC,MAAM,EAAE;QAClB,QAAQ,CAAC,IAAI,OAAb,QAAQ,2BAAS,IAAA,0CAAwB,EAAC,UAAU,CAAC,MAAM,EAAE,EAAE,OAAO,EAAE,YAAY,EAAC,CAAC,WAAE;KAC3F;IAED,OAAO,QAAQ,CAAC;AACpB,CAAC;AAxBD,4BAwBC;AAED,SAAgB,WAAW;IACvB,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC;QACjB,MAAM,EAAE,MAAM;KACjB,CAAC,CAAC,CAAC;AACR,CAAC;AAJD,kCAIC","sourcesContent":["import url from 'url';\n\nimport { generateMatchFromFilterExpr } from './filterGenerator';\nimport { generateLimitFromTopExpr } from './limitGenerator';\nimport { generateSkipFromSkipExpr } from './skipGenerator';\nimport { generateSortFromOrderbyExpr } from './sortGenerator';\nimport { generateLookupFromExpand } from './lookupGenerator';\n\nimport { oDataParameters } from 'odatafy-parser';\nimport { Document } from 'mongodb';\n\nexport function getQueryFromUrl(oDataUrl: string): Document[] {\n    const query = url.parse(oDataUrl, true).query;\n    const validParams = [ 'filter', 'orderby', 'skip', 'top', 'expand' ];\n    const params = Object.keys(query);\n\n    let parseParameters: oDataParameters = {}\n\n    validParams.forEach((param: string) =>{\n        //check if url \n        if(params.includes(param) && params.includes('$' + param)) {\n            throw new Error(`Malformed oData url, cannot contain param: ${param} and param: $${param}`)\n        }\n\n        if(params.includes(param) || params.includes('$' + param)) {\n            parseParameters[param as keyof oDataParameters] = query[(params.includes(param)? param: '$' + param)] as string\n        }\n    });\n\n    return getQuery(parseParameters);\n}\n\nexport function getQuery(parameters: oDataParameters): Document[] {\n    const pipeline: Document[] = [];\n\n    if (parameters.filter) {\n        pipeline.push(generateMatchFromFilterExpr(parameters.filter));\n    }\n\n    if(parameters.orderby) {\n        pipeline.push(generateSortFromOrderbyExpr(parameters.orderby));\n    }\n\n    if (parameters.skip) {\n        pipeline.push(generateSkipFromSkipExpr(parameters.skip));\n    }\n\n    if (parameters.top) {\n        pipeline.push(generateLimitFromTopExpr(parameters.top));\n    }\n\n    if(parameters.expand) {\n        pipeline.push(...generateLookupFromExpand(parameters.expand, { 'items': 'orderItems'}));\n    }\n\n    return pipeline;\n}\n\nexport function testMongoDB() {\n    console.log(getQuery({ \n        expand: \"Test\"\n    }));\n}"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"417ee96073540de6bffd08c3aac1b443d9fb9e47","contentHash":"1d42adbf74a081bfffa6621c92026781bc5dae22750f91a4c81af7c7e0185e10"},"/home/administrator/private/odatafy-mongodb/src/filterGenerator.ts":{"path":"/home/administrator/private/odatafy-mongodb/src/filterGenerator.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":74}},"2":{"start":{"line":4,"column":23},"end":{"line":4,"column":48}},"3":{"start":{"line":6,"column":14},"end":{"line":6,"column":61}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":35}},"5":{"start":{"line":9,"column":0},"end":{"line":9,"column":66}},"6":{"start":{"line":11,"column":4},"end":{"line":13,"column":6}},"7":{"start":{"line":15,"column":0},"end":{"line":15,"column":48}},"8":{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},"9":{"start":{"line":18,"column":8},"end":{"line":18,"column":67}},"10":{"start":{"line":20,"column":4},"end":{"line":30,"column":5}},"11":{"start":{"line":23,"column":12},"end":{"line":23,"column":57}},"12":{"start":{"line":25,"column":12},"end":{"line":25,"column":45}},"13":{"start":{"line":27,"column":12},"end":{"line":27,"column":43}},"14":{"start":{"line":29,"column":12},"end":{"line":29,"column":76}},"15":{"start":{"line":33,"column":20},"end":{"line":33,"column":25}},"16":{"start":{"line":34,"column":17},"end":{"line":34,"column":19}},"17":{"start":{"line":35,"column":4},"end":{"line":111,"column":5}},"18":{"start":{"line":37,"column":12},"end":{"line":42,"column":14}},"19":{"start":{"line":43,"column":12},"end":{"line":43,"column":18}},"20":{"start":{"line":45,"column":12},"end":{"line":50,"column":14}},"21":{"start":{"line":51,"column":12},"end":{"line":51,"column":18}},"22":{"start":{"line":58,"column":12},"end":{"line":58,"column":29}},"23":{"start":{"line":59,"column":21},"end":{"line":59,"column":28}},"24":{"start":{"line":60,"column":12},"end":{"line":62,"column":13}},"25":{"start":{"line":61,"column":16},"end":{"line":61,"column":27}},"26":{"start":{"line":63,"column":12},"end":{"line":65,"column":13}},"27":{"start":{"line":64,"column":16},"end":{"line":64,"column":27}},"28":{"start":{"line":66,"column":12},"end":{"line":66,"column":99}},"29":{"start":{"line":67,"column":12},"end":{"line":67,"column":18}},"30":{"start":{"line":69,"column":12},"end":{"line":69,"column":29}},"31":{"start":{"line":70,"column":12},"end":{"line":74,"column":14}},"32":{"start":{"line":75,"column":12},"end":{"line":75,"column":18}},"33":{"start":{"line":77,"column":12},"end":{"line":79,"column":14}},"34":{"start":{"line":80,"column":12},"end":{"line":80,"column":18}},"35":{"start":{"line":82,"column":12},"end":{"line":84,"column":14}},"36":{"start":{"line":85,"column":12},"end":{"line":85,"column":18}},"37":{"start":{"line":87,"column":12},"end":{"line":89,"column":14}},"38":{"start":{"line":90,"column":12},"end":{"line":90,"column":18}},"39":{"start":{"line":92,"column":12},"end":{"line":94,"column":14}},"40":{"start":{"line":95,"column":12},"end":{"line":95,"column":18}},"41":{"start":{"line":97,"column":12},"end":{"line":99,"column":14}},"42":{"start":{"line":100,"column":12},"end":{"line":100,"column":18}},"43":{"start":{"line":102,"column":12},"end":{"line":102,"column":29}},"44":{"start":{"line":103,"column":12},"end":{"line":107,"column":14}},"45":{"start":{"line":108,"column":12},"end":{"line":108,"column":18}},"46":{"start":{"line":110,"column":12},"end":{"line":110,"column":70}},"47":{"start":{"line":112,"column":4},"end":{"line":116,"column":5}},"48":{"start":{"line":113,"column":8},"end":{"line":115,"column":10}},"49":{"start":{"line":117,"column":4},"end":{"line":117,"column":18}},"50":{"start":{"line":120,"column":4},"end":{"line":120,"column":22}},"51":{"start":{"line":123,"column":4},"end":{"line":123,"column":34}}},"fnMap":{"0":{"name":"generateMatchFromFilterExpr","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":36}},"loc":{"start":{"line":5,"column":49},"end":{"line":8,"column":1}},"line":5},"1":{"name":"generateMatchStage","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":27}},"loc":{"start":{"line":10,"column":33},"end":{"line":14,"column":1}},"line":10},"2":{"name":"processNode","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":20}},"loc":{"start":{"line":16,"column":39},"end":{"line":31,"column":1}},"line":16},"3":{"name":"processOperatorNode","decl":{"start":{"line":32,"column":9},"end":{"line":32,"column":28}},"loc":{"start":{"line":32,"column":47},"end":{"line":118,"column":1}},"line":32},"4":{"name":"processConstantNode","decl":{"start":{"line":119,"column":9},"end":{"line":119,"column":28}},"loc":{"start":{"line":119,"column":35},"end":{"line":121,"column":1}},"line":119},"5":{"name":"processSymbolNode","decl":{"start":{"line":122,"column":9},"end":{"line":122,"column":26}},"loc":{"start":{"line":122,"column":33},"end":{"line":124,"column":1}},"line":122}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},{"start":{"line":17,"column":4},"end":{"line":19,"column":5}}],"line":17},"1":{"loc":{"start":{"line":20,"column":4},"end":{"line":30,"column":5}},"type":"switch","locations":[{"start":{"line":21,"column":8},"end":{"line":21,"column":53}},{"start":{"line":22,"column":8},"end":{"line":23,"column":57}},{"start":{"line":24,"column":8},"end":{"line":25,"column":45}},{"start":{"line":26,"column":8},"end":{"line":27,"column":43}},{"start":{"line":28,"column":8},"end":{"line":29,"column":76}}],"line":20},"2":{"loc":{"start":{"line":35,"column":4},"end":{"line":111,"column":5}},"type":"switch","locations":[{"start":{"line":36,"column":8},"end":{"line":43,"column":18}},{"start":{"line":44,"column":8},"end":{"line":51,"column":18}},{"start":{"line":52,"column":8},"end":{"line":52,"column":55}},{"start":{"line":53,"column":8},"end":{"line":53,"column":55}},{"start":{"line":54,"column":8},"end":{"line":54,"column":55}},{"start":{"line":55,"column":8},"end":{"line":55,"column":55}},{"start":{"line":56,"column":8},"end":{"line":56,"column":55}},{"start":{"line":57,"column":8},"end":{"line":67,"column":18}},{"start":{"line":68,"column":8},"end":{"line":75,"column":18}},{"start":{"line":76,"column":8},"end":{"line":80,"column":18}},{"start":{"line":81,"column":8},"end":{"line":85,"column":18}},{"start":{"line":86,"column":8},"end":{"line":90,"column":18}},{"start":{"line":91,"column":8},"end":{"line":95,"column":18}},{"start":{"line":96,"column":8},"end":{"line":100,"column":18}},{"start":{"line":101,"column":8},"end":{"line":108,"column":18}},{"start":{"line":109,"column":8},"end":{"line":110,"column":70}}],"line":35},"3":{"loc":{"start":{"line":60,"column":12},"end":{"line":62,"column":13}},"type":"if","locations":[{"start":{"line":60,"column":12},"end":{"line":62,"column":13}},{"start":{"line":60,"column":12},"end":{"line":62,"column":13}}],"line":60},"4":{"loc":{"start":{"line":63,"column":12},"end":{"line":65,"column":13}},"type":"if","locations":[{"start":{"line":63,"column":12},"end":{"line":65,"column":13}},{"start":{"line":63,"column":12},"end":{"line":65,"column":13}}],"line":63},"5":{"loc":{"start":{"line":112,"column":4},"end":{"line":116,"column":5}},"type":"if","locations":[{"start":{"line":112,"column":4},"end":{"line":116,"column":5}},{"start":{"line":112,"column":4},"end":{"line":116,"column":5}}],"line":112},"6":{"loc":{"start":{"line":112,"column":8},"end":{"line":112,"column":32}},"type":"binary-expr","locations":[{"start":{"line":112,"column":8},"end":{"line":112,"column":19}},{"start":{"line":112,"column":23},"end":{"line":112,"column":32}}],"line":112}},"s":{"0":1,"1":1,"2":1,"3":54,"4":54,"5":1,"6":55,"7":1,"8":241,"9":0,"10":241,"11":99,"12":83,"13":59,"14":0,"15":99,"16":99,"17":99,"18":2,"19":2,"20":2,"21":2,"22":59,"23":59,"24":59,"25":4,"26":59,"27":4,"28":59,"29":59,"30":12,"31":12,"32":12,"33":4,"34":4,"35":4,"36":4,"37":4,"38":4,"39":4,"40":4,"41":4,"42":4,"43":4,"44":4,"45":4,"46":0,"47":99,"48":59,"49":40,"50":83,"51":59},"f":{"0":54,"1":55,"2":241,"3":99,"4":83,"5":59},"b":{"0":[0,241],"1":[99,99,83,59,0],"2":[2,2,9,14,33,51,55,59,12,4,4,4,4,4,4,0],"3":[4,55],"4":[4,55],"5":[59,40],"6":[99,63]},"inputSourceMap":{"version":3,"file":"/home/administrator/private/odatafy-mongodb/src/filterGenerator.ts","sources":["/home/administrator/private/odatafy-mongodb/src/filterGenerator.ts"],"names":[],"mappings":"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","sourcesContent":["import { filterParser, FilterNode, NodeTypes, OperatorNode, ConstantNode, SymbolNode, OperatorNodeOperators } from 'odatafy-parser';\nimport { Document } from 'mongodb';\n\nexport function generateMatchFromFilterExpr(filterExpr: string): Document {\n    const ast = filterParser.parse(filterExpr);\n\n    return generateMatchStage(ast);\n}\n\nexport function generateMatchStage(ast: FilterNode): Document {\n    return {\n        '$match': processNode(ast)\n    }\n}\n\nfunction processNode(node: FilterNode, parentExpr?: boolean): any {\n    if (!node) {\n        throw new Error('Something went wrong, node is undefined');\n    }\n\n    switch (node.nodeType) {\n        case NodeTypes.OperatorNode:\n        case undefined:\n            return processOperatorNode(node, parentExpr);\n        case NodeTypes.ConstantNode:\n            return processConstantNode(node);\n        case NodeTypes.SymbolNode:\n            return processSymbolNode(node);\n        default:\n            throw new Error(`Unsupported NodeType: ${node.nodeType}`)\n    }\n}\n\nfunction processOperatorNode(node: OperatorNode, parentExpr?: boolean): Document {\n    let needsExpr = false;\n    let result: Document = {};\n\n    switch (node.op) {\n        case OperatorNodeOperators.And:\n            result = {\n                '$and': [\n                    processNode(node.left, parentExpr),\n                    processNode(node.right, parentExpr)\n                ]\n            }\n            break;\n        case OperatorNodeOperators.Or:\n            result = {\n                '$or': [\n                    processNode(node.left, parentExpr),\n                    processNode(node.right, parentExpr)\n                ]\n            }\n            break;\n        case OperatorNodeOperators.Eq:\n        case OperatorNodeOperators.Ne:\n        case OperatorNodeOperators.Lt:\n        case OperatorNodeOperators.Gt:\n        case OperatorNodeOperators.Le:\n        case OperatorNodeOperators.Ge:\n            needsExpr = true;\n            let op: OperatorNodeOperators | 'gte' | 'lte' = node.op;\n\n            if (op == OperatorNodeOperators.Le) {\n                op = 'lte';\n            }\n\n            if (op == OperatorNodeOperators.Ge) {\n                op = 'gte';\n            }\n\n            result[`$${op}`] = [processNode(node.left, true), processNode(node.right, true)];\n            break;\n        case OperatorNodeOperators.Not:\n            needsExpr = true;\n\n            result = {\n                '$not': [\n                    processNode(node.right, true)\n                ]\n            }\n            break;\n        case OperatorNodeOperators.Add: //add\n            result = {\n                '$add': [processNode(node.left, true), processNode(node.right, true)]\n            }\n            break;\n        case OperatorNodeOperators.Mod: //mod\n            result = {\n                '$mod': [processNode(node.left, true), processNode(node.right, true)]\n            }\n            break;\n        case OperatorNodeOperators.Divby: //divide\n            result = {\n                '$divide': [processNode(node.left, true), processNode(node.right, true)]\n            }\n            break;\n        case OperatorNodeOperators.Sub: //subtract\n            result = {\n                '$subtract': [processNode(node.left, true), processNode(node.right, true)]\n            }\n            break;\n        case OperatorNodeOperators.Mul: //multiply\n            result = {\n                '$multiply': [processNode(node.left, true), processNode(node.right, true)]\n            }\n            break;\n        case OperatorNodeOperators.Div: //integer division\n            needsExpr = true;\n            result = {\n                '$toInt': {\n                    '$divide': [processNode(node.left, true), processNode(node.right, true)]\n                }\n            }\n            break;\n        default:\n            throw new Error(`Unsupported operator: ${node.op}`)\n    }\n\n    if (!parentExpr && needsExpr) {\n        return {\n            \"$expr\": result\n        }\n    }\n\n    return result\n}\n\n\nfunction processConstantNode(node: ConstantNode) {\n    return node.value;\n}\n\nfunction processSymbolNode(node: SymbolNode) {\n    return `$${node.value}`\n}"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e3f58585cbc7b562f6827a0abb254522457a3582","contentHash":"fdf5505ec058018be102bcb006d00d3d96498bf3717637ae0641c95a09fa0e37"},"/home/administrator/private/odatafy-mongodb/src/limitGenerator.ts":{"path":"/home/administrator/private/odatafy-mongodb/src/limitGenerator.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":71}},"2":{"start":{"line":4,"column":23},"end":{"line":4,"column":48}},"3":{"start":{"line":6,"column":4},"end":{"line":8,"column":6}},"4":{"start":{"line":10,"column":0},"end":{"line":10,"column":48}},"5":{"start":{"line":12,"column":14},"end":{"line":12,"column":52}},"6":{"start":{"line":13,"column":4},"end":{"line":13,"column":35}},"7":{"start":{"line":15,"column":0},"end":{"line":15,"column":60}}},"fnMap":{"0":{"name":"generateLimitStage","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":27}},"loc":{"start":{"line":5,"column":35},"end":{"line":9,"column":1}},"line":5},"1":{"name":"generateLimitFromTopExpr","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":33}},"loc":{"start":{"line":11,"column":40},"end":{"line":14,"column":1}},"line":11}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"f":{"0":1,"1":1},"b":{},"inputSourceMap":{"version":3,"file":"/home/administrator/private/odatafy-mongodb/src/limitGenerator.ts","sources":["/home/administrator/private/odatafy-mongodb/src/limitGenerator.ts"],"names":[],"mappings":";;;AACA,iDAA2C;AAE3C,SAAgB,kBAAkB,CAAC,KAAa;IAC5C,OAAO;QACH,QAAQ,EAAE,KAAK;KAClB,CAAA;AACL,CAAC;AAJD,gDAIC;AAED,SAAgB,wBAAwB,CAAC,IAAY;IACjD,IAAM,GAAG,GAAG,0BAAS,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IAElC,OAAO,kBAAkB,CAAC,GAAG,CAAC,CAAC;AACnC,CAAC;AAJD,4DAIC","sourcesContent":["import { Document } from 'mongodb';\nimport { topParser } from 'odatafy-parser';\n\nexport function generateLimitStage(limit: number): Document {\n    return {\n        '$limit': limit\n    }\n}\n\nexport function generateLimitFromTopExpr(expr: string): Document {\n    const top = topParser.parse(expr);\n\n    return generateLimitStage(top);\n}"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"0440dcc0ec653aed80dba40c22f88844f4c9cb8d","contentHash":"6e3d54a79b73a77570735ef9aa68ba8572bcaea52d64579f73de7deadcb9e877"},"/home/administrator/private/odatafy-mongodb/src/skipGenerator.ts":{"path":"/home/administrator/private/odatafy-mongodb/src/skipGenerator.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":70}},"2":{"start":{"line":4,"column":23},"end":{"line":4,"column":48}},"3":{"start":{"line":6,"column":15},"end":{"line":6,"column":54}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":35}},"5":{"start":{"line":9,"column":0},"end":{"line":9,"column":60}},"6":{"start":{"line":11,"column":4},"end":{"line":13,"column":6}},"7":{"start":{"line":15,"column":0},"end":{"line":15,"column":46}}},"fnMap":{"0":{"name":"generateSkipFromSkipExpr","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":33}},"loc":{"start":{"line":5,"column":40},"end":{"line":8,"column":1}},"line":5},"1":{"name":"generateSkipStage","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":26}},"loc":{"start":{"line":10,"column":33},"end":{"line":14,"column":1}},"line":10}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"f":{"0":1,"1":1},"b":{},"inputSourceMap":{"version":3,"file":"/home/administrator/private/odatafy-mongodb/src/skipGenerator.ts","sources":["/home/administrator/private/odatafy-mongodb/src/skipGenerator.ts"],"names":[],"mappings":";;;AACA,iDAA4C;AAE5C,SAAgB,wBAAwB,CAAC,IAAY;IACjD,IAAM,IAAI,GAAG,2BAAU,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IAEpC,OAAO,iBAAiB,CAAC,IAAI,CAAC,CAAC;AACnC,CAAC;AAJD,4DAIC;AAED,SAAgB,iBAAiB,CAAC,IAAY;IAC1C,OAAO;QACH,OAAO,EAAE,IAAI;KAChB,CAAA;AACL,CAAC;AAJD,8CAIC","sourcesContent":["import { Document } from 'mongodb';\nimport { skipParser } from 'odatafy-parser';\n\nexport function generateSkipFromSkipExpr(expr: string): Document {\n    const skip = skipParser.parse(expr);\n\n    return generateSkipStage(skip);\n}\n\nexport function generateSkipStage(skip: number): Document {\n    return {\n        '$skip': skip\n    }\n}"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5ae9085f0a6bf3e695ff54ee393a42f7c4d59749","contentHash":"0cc31f3acbc9c21a92ab2e59e52e30e9de3d08d22c5a4cca4c85a2ff392d7a1f"},"/home/administrator/private/odatafy-mongodb/src/sortGenerator.ts":{"path":"/home/administrator/private/odatafy-mongodb/src/sortGenerator.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":73}},"2":{"start":{"line":4,"column":23},"end":{"line":4,"column":48}},"3":{"start":{"line":6,"column":14},"end":{"line":6,"column":56}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":34}},"5":{"start":{"line":9,"column":0},"end":{"line":9,"column":66}},"6":{"start":{"line":11,"column":17},"end":{"line":13,"column":5}},"7":{"start":{"line":14,"column":4},"end":{"line":16,"column":7}},"8":{"start":{"line":15,"column":8},"end":{"line":15,"column":93}},"9":{"start":{"line":17,"column":4},"end":{"line":17,"column":18}},"10":{"start":{"line":19,"column":0},"end":{"line":19,"column":46}}},"fnMap":{"0":{"name":"generateSortFromOrderbyExpr","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":36}},"loc":{"start":{"line":5,"column":43},"end":{"line":8,"column":1}},"line":5},"1":{"name":"generateSortStage","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":26}},"loc":{"start":{"line":10,"column":32},"end":{"line":18,"column":1}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":14,"column":22},"end":{"line":14,"column":23}},"loc":{"start":{"line":14,"column":38},"end":{"line":16,"column":5}},"line":14}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":35},"end":{"line":15,"column":92}},"type":"cond-expr","locations":[{"start":{"line":15,"column":86},"end":{"line":15,"column":87}},{"start":{"line":15,"column":90},"end":{"line":15,"column":92}}],"line":15}},"s":{"0":1,"1":1,"2":1,"3":3,"4":3,"5":1,"6":3,"7":3,"8":3,"9":3,"10":1},"f":{"0":3,"1":3,"2":3},"b":{"0":[2,1]},"inputSourceMap":{"version":3,"file":"/home/administrator/private/odatafy-mongodb/src/sortGenerator.ts","sources":["/home/administrator/private/odatafy-mongodb/src/sortGenerator.ts"],"names":[],"mappings":";;;AACA,iDAA4E;AAE5E,SAAgB,2BAA2B,CAAC,IAAY;IACpD,IAAM,GAAG,GAAG,8BAAa,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IAEtC,OAAO,iBAAiB,CAAC,GAAG,CAAC,CAAC;AAClC,CAAC;AAJD,kEAIC;AAED,SAAgB,iBAAiB,CAAC,GAAgB;IAC9C,IAAI,MAAM,GAAa;QACnB,OAAO,EAAE,EAAG;KACf,CAAA;IAED,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,UAAA,IAAI;QAClB,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,IAAI,IAAI,+BAAc,CAAC,GAAG,CAAA,CAAC,CAAC,CAAC,CAAA,CAAC,CAAC,CAAC,CAAC,CAAC;IACtE,CAAC,CAAC,CAAC;IAEH,OAAO,MAAM,CAAC;AAClB,CAAC;AAVD,8CAUC","sourcesContent":["import { Document } from 'mongodb';\nimport { orderbyParser, OrderDirection, OrderbyNode } from 'odatafy-parser';\n\nexport function generateSortFromOrderbyExpr(expr: string): Document {\n    const ast = orderbyParser.parse(expr);\n\n    return generateSortStage(ast);\n}\n\nexport function generateSortStage(ast: OrderbyNode): Document {\n    let result: Document = {\n        '$sort': { }\n    }\n\n    ast.value.forEach(node => {\n        result.$sort[node.value] = node.type == OrderDirection.Asc? 1: -1;\n    });\n\n    return result;\n}"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4d478b33f1e1c531478961942c1b588c38e68740","contentHash":"93d37591df6e02b57004b41c4b246deaf9d0dbeb487f71de3ed4893e2e4537f2"},"/home/administrator/private/odatafy-mongodb/src/lookupGenerator.ts":{"path":"/home/administrator/private/odatafy-mongodb/src/lookupGenerator.ts","statementMap":{"0":{"start":{"line":2,"column":13},"end":{"line":17,"column":1}},"1":{"start":{"line":3,"column":12},"end":{"line":3,"column":62}},"2":{"start":{"line":4,"column":4},"end":{"line":4,"column":21}},"3":{"start":{"line":4,"column":12},"end":{"line":4,"column":21}},"4":{"start":{"line":5,"column":12},"end":{"line":5,"column":21}},"5":{"start":{"line":5,"column":31},"end":{"line":5,"column":33}},"6":{"start":{"line":6,"column":4},"end":{"line":15,"column":5}},"7":{"start":{"line":7,"column":8},"end":{"line":7,"column":83}},"8":{"start":{"line":7,"column":66},"end":{"line":7,"column":83}},"9":{"start":{"line":9,"column":20},"end":{"line":9,"column":41}},"10":{"start":{"line":11,"column":8},"end":{"line":14,"column":41}},"11":{"start":{"line":12,"column":12},"end":{"line":12,"column":61}},"12":{"start":{"line":12,"column":51},"end":{"line":12,"column":61}},"13":{"start":{"line":14,"column":18},"end":{"line":14,"column":39}},"14":{"start":{"line":14,"column":25},"end":{"line":14,"column":39}},"15":{"start":{"line":16,"column":4},"end":{"line":16,"column":14}},"16":{"start":{"line":18,"column":20},"end":{"line":26,"column":1}},"17":{"start":{"line":19,"column":4},"end":{"line":24,"column":5}},"18":{"start":{"line":19,"column":40},"end":{"line":24,"column":5}},"19":{"start":{"line":19,"column":53},"end":{"line":19,"column":54}},"20":{"start":{"line":19,"column":60},"end":{"line":19,"column":71}},"21":{"start":{"line":20,"column":8},"end":{"line":23,"column":9}},"22":{"start":{"line":21,"column":12},"end":{"line":21,"column":65}},"23":{"start":{"line":21,"column":21},"end":{"line":21,"column":65}},"24":{"start":{"line":22,"column":12},"end":{"line":22,"column":28}},"25":{"start":{"line":25,"column":4},"end":{"line":25,"column":61}},"26":{"start":{"line":27,"column":0},"end":{"line":27,"column":62}},"27":{"start":{"line":28,"column":0},"end":{"line":28,"column":42}},"28":{"start":{"line":29,"column":23},"end":{"line":29,"column":48}},"29":{"start":{"line":30,"column":24},"end":{"line":30,"column":52}},"30":{"start":{"line":31,"column":22},"end":{"line":31,"column":48}},"31":{"start":{"line":32,"column":23},"end":{"line":32,"column":50}},"32":{"start":{"line":33,"column":22},"end":{"line":33,"column":48}},"33":{"start":{"line":35,"column":17},"end":{"line":35,"column":19}},"34":{"start":{"line":36,"column":18},"end":{"line":36,"column":59}},"35":{"start":{"line":37,"column":4},"end":{"line":53,"column":7}},"36":{"start":{"line":39,"column":23},"end":{"line":39,"column":25}},"37":{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},"38":{"start":{"line":41,"column":12},"end":{"line":41,"column":90}},"39":{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},"40":{"start":{"line":44,"column":12},"end":{"line":44,"column":88}},"41":{"start":{"line":46,"column":8},"end":{"line":48,"column":9}},"42":{"start":{"line":47,"column":12},"end":{"line":47,"column":85}},"43":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"44":{"start":{"line":50,"column":12},"end":{"line":50,"column":86}},"45":{"start":{"line":52,"column":8},"end":{"line":52,"column":163}},"46":{"start":{"line":54,"column":4},"end":{"line":54,"column":18}},"47":{"start":{"line":56,"column":0},"end":{"line":56,"column":60}},"48":{"start":{"line":58,"column":4},"end":{"line":58,"column":47}},"49":{"start":{"line":58,"column":31},"end":{"line":58,"column":45}},"50":{"start":{"line":59,"column":16},"end":{"line":105,"column":5}},"51":{"start":{"line":106,"column":20},"end":{"line":112,"column":10}},"52":{"start":{"line":113,"column":4},"end":{"line":132,"column":6}},"53":{"start":{"line":133,"column":4},"end":{"line":133,"column":92}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":38},"end":{"line":2,"column":39}},"loc":{"start":{"line":2,"column":54},"end":{"line":17,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":18,"column":52},"end":{"line":18,"column":53}},"loc":{"start":{"line":18,"column":78},"end":{"line":26,"column":1}},"line":18},"2":{"name":"generateLookupFromExpand","decl":{"start":{"line":34,"column":9},"end":{"line":34,"column":33}},"loc":{"start":{"line":34,"column":55},"end":{"line":55,"column":1}},"line":34},"3":{"name":"(anonymous_3)","decl":{"start":{"line":37,"column":26},"end":{"line":37,"column":27}},"loc":{"start":{"line":37,"column":42},"end":{"line":53,"column":5}},"line":37},"4":{"name":"getLookupQuery","decl":{"start":{"line":57,"column":9},"end":{"line":57,"column":23}},"loc":{"start":{"line":57,"column":53},"end":{"line":134,"column":1}},"line":57}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":13},"end":{"line":17,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":14},"end":{"line":2,"column":18}},{"start":{"line":2,"column":22},"end":{"line":2,"column":33}},{"start":{"line":2,"column":38},"end":{"line":17,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":62}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":40}},{"start":{"line":3,"column":44},"end":{"line":3,"column":62}}],"line":3},"2":{"loc":{"start":{"line":4,"column":4},"end":{"line":4,"column":21}},"type":"if","locations":[{"start":{"line":4,"column":4},"end":{"line":4,"column":21}},{"start":{"line":4,"column":4},"end":{"line":4,"column":21}}],"line":4},"3":{"loc":{"start":{"line":7,"column":15},"end":{"line":7,"column":64}},"type":"binary-expr","locations":[{"start":{"line":7,"column":16},"end":{"line":7,"column":28}},{"start":{"line":7,"column":32},"end":{"line":7,"column":39}},{"start":{"line":7,"column":44},"end":{"line":7,"column":64}}],"line":7},"4":{"loc":{"start":{"line":12,"column":12},"end":{"line":12,"column":61}},"type":"if","locations":[{"start":{"line":12,"column":12},"end":{"line":12,"column":61}},{"start":{"line":12,"column":12},"end":{"line":12,"column":61}}],"line":12},"5":{"loc":{"start":{"line":12,"column":16},"end":{"line":12,"column":49}},"type":"binary-expr","locations":[{"start":{"line":12,"column":16},"end":{"line":12,"column":17}},{"start":{"line":12,"column":21},"end":{"line":12,"column":28}},{"start":{"line":12,"column":33},"end":{"line":12,"column":48}}],"line":12},"6":{"loc":{"start":{"line":14,"column":18},"end":{"line":14,"column":39}},"type":"if","locations":[{"start":{"line":14,"column":18},"end":{"line":14,"column":39}},{"start":{"line":14,"column":18},"end":{"line":14,"column":39}}],"line":14},"7":{"loc":{"start":{"line":18,"column":20},"end":{"line":26,"column":1}},"type":"binary-expr","locations":[{"start":{"line":18,"column":21},"end":{"line":18,"column":25}},{"start":{"line":18,"column":29},"end":{"line":18,"column":47}},{"start":{"line":18,"column":52},"end":{"line":26,"column":1}}],"line":18},"8":{"loc":{"start":{"line":19,"column":4},"end":{"line":24,"column":5}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":24,"column":5}},{"start":{"line":19,"column":4},"end":{"line":24,"column":5}}],"line":19},"9":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":38}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":12}},{"start":{"line":19,"column":16},"end":{"line":19,"column":38}}],"line":19},"10":{"loc":{"start":{"line":20,"column":8},"end":{"line":23,"column":9}},"type":"if","locations":[{"start":{"line":20,"column":8},"end":{"line":23,"column":9}},{"start":{"line":20,"column":8},"end":{"line":23,"column":9}}],"line":20},"11":{"loc":{"start":{"line":20,"column":12},"end":{"line":20,"column":30}},"type":"binary-expr","locations":[{"start":{"line":20,"column":12},"end":{"line":20,"column":14}},{"start":{"line":20,"column":18},"end":{"line":20,"column":30}}],"line":20},"12":{"loc":{"start":{"line":21,"column":12},"end":{"line":21,"column":65}},"type":"if","locations":[{"start":{"line":21,"column":12},"end":{"line":21,"column":65}},{"start":{"line":21,"column":12},"end":{"line":21,"column":65}}],"line":21},"13":{"loc":{"start":{"line":25,"column":21},"end":{"line":25,"column":59}},"type":"binary-expr","locations":[{"start":{"line":25,"column":21},"end":{"line":25,"column":23}},{"start":{"line":25,"column":27},"end":{"line":25,"column":59}}],"line":25},"14":{"loc":{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},"type":"if","locations":[{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},{"start":{"line":40,"column":8},"end":{"line":42,"column":9}}],"line":40},"15":{"loc":{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},"type":"if","locations":[{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},{"start":{"line":43,"column":8},"end":{"line":45,"column":9}}],"line":43},"16":{"loc":{"start":{"line":46,"column":8},"end":{"line":48,"column":9}},"type":"if","locations":[{"start":{"line":46,"column":8},"end":{"line":48,"column":9}},{"start":{"line":46,"column":8},"end":{"line":48,"column":9}}],"line":46},"17":{"loc":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"type":"if","locations":[{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},{"start":{"line":49,"column":8},"end":{"line":51,"column":9}}],"line":49},"18":{"loc":{"start":{"line":58,"column":4},"end":{"line":58,"column":47}},"type":"if","locations":[{"start":{"line":58,"column":4},"end":{"line":58,"column":47}},{"start":{"line":58,"column":4},"end":{"line":58,"column":47}}],"line":58}},"s":{"0":1,"1":10,"2":10,"3":0,"4":10,"5":10,"6":10,"7":10,"8":17,"9":0,"10":10,"11":10,"12":0,"13":10,"14":0,"15":10,"16":1,"17":10,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":10,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":2,"34":2,"35":2,"36":2,"37":2,"38":1,"39":2,"40":0,"41":2,"42":0,"43":2,"44":0,"45":2,"46":2,"47":1,"48":2,"49":0,"50":2,"51":2,"52":2,"53":2},"f":{"0":10,"1":10,"2":2,"3":2,"4":2},"b":{"0":[1,1,1],"1":[10,10],"2":[0,10],"3":[27,0,27],"4":[0,10],"5":[10,10,0],"6":[0,10],"7":[1,1,1],"8":[0,10],"9":[10,10],"10":[0,0],"11":[0,0],"12":[0,0],"13":[10,10],"14":[1,1],"15":[0,2],"16":[0,2],"17":[0,2],"18":[0,2]},"inputSourceMap":{"version":3,"file":"/home/administrator/private/odatafy-mongodb/src/lookupGenerator.ts","sources":["/home/administrator/private/odatafy-mongodb/src/lookupGenerator.ts"],"names":[],"mappings":"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","sourcesContent":["import { Document } from \"mongodb\";\nimport { ExpandItemNode, expandParser } from \"odatafy-parser\";\n\nimport { generateMatchStage } from \"./filterGenerator\";\nimport { generateSortStage } from \"./sortGenerator\";\nimport { generateLimitStage } from \"./limitGenerator\";\nimport { generateSkipStage } from \"./skipGenerator\";\n\nexport type CollectionMap = {\n  [key: string]: string;\n};\n\nexport function generateLookupFromExpand(\n  expr: string,\n  collectionMap: CollectionMap,\n): Document[] {\n  let result: Document[] = [];\n\n  const expNode = expandParser.parse(expr);\n\n  expNode.value.forEach((node: ExpandItemNode) => {\n    //generate lookup pipeline\n    const pipeline: Document[] = [];\n\n    if (node.options.filter) {\n      pipeline.push(generateMatchStage(node.options.filter));\n    }\n\n    if (node.options.orderby) {\n      pipeline.push(generateSortStage(node.options.orderby));\n    }\n\n    if (node.options.skip) {\n      pipeline.push(generateSkipStage(node.options.skip));\n    }\n\n    if (node.options.top) {\n      pipeline.push(generateLimitStage(node.options.top));\n    }\n\n    result = [...result, ...getLookupQuery(node.identifier, collectionMap[node.identifier], pipeline)];\n  });\n\n  return result;\n}\n\nfunction getLookupQuery(field: string, collection: string, pipeline: Document[] = []): Document[] {\n  let query: Document[] = [\n    {\n      \"$addFields\": {\n        \"mongodbODataTempJoinIsArray\": {\n          \"$isArray\": `$${field}`,\n        },\n      },\n    },\n    {\n      \"$lookup\": {\n        from: `${collection}`,\n        let: {\n          \"mongodbODataTempJoinIsArray\": \"$mongodbODataTempJoinIsArray\",\n          \"mongodbODataTempJoinFieldValue\": `$${field}`\n        },\n        pipeline: [\n          {\n            \"$match\": {\n              \"$expr\": {\n                \"$eq\": [\n                  {\n                    \"$cond\": {\n                      \"if\": \"$$mongodbODataTempJoinIsArray\",\n                      \"then\": {\n                          \"$in\": [\n                            \"$_id\", \n                            \"$$mongodbODataTempJoinFieldValue\"\n                          ]\n                      },\n                      \"else\": {\n                        \"$eq\": [\n                          \"$_id\",\n                          \"$$mongodbODataTempJoinFieldValue\"\n                        ]\n                      },\n  \n                    },\n                  },\n                  true\n                ]\n              }\n            }\n          },\n          ...pipeline\n        ],\n        as: `${field}`\n      },\n    }\n  ];\n\n  let extension: Document[] = [{\n    \"$set\": {},\n  }, {\n    \"$project\": {\n      \"mongodbODataTempJoinIsArray\": 0,\n    },\n  }];\n\n  extension[0][\"$set\"][`${field}`] = {\n    \"$cond\": {\n      \"if\": \"$mongodbODataTempJoinIsArray\",\n      \"then\": `$${field}`,\n      \"else\": {\n        \"$cond\": {\n          \"if\": {\n            \"$eq\": [\n              `$${field}`,\n              [],\n            ],\n          },\n          \"then\": null,\n          \"else\": {\n            \"$first\": `$${field}`,\n          },\n        },\n      },\n    },\n  };\n\n  return [...query, ...extension];\n}"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4445dbd6a0cddade689b2f6444b3ab019d6d1a4e","contentHash":"5328a422c10b2ad12df9ad646ee8f2fae5fb81b3d03bc8037c8e684633efa049"}}